<ion-card class="jodel-card" [style]="{'--post-bg': post.backgroundColor, '--post-fg': post.color}">
  <!-- header -->
  <div class="jdl-h">
    <div class="jdl-user" [style]="{'color':'var(--post-fg)'}" (click)="showUserProfile(post.user.id)">
      <i *ngIf="post.anonyme" class="fas fa-user-secret"></i>
      <i *ngIf="!post.anonyme" class="fas fa-user"></i>
      <span class="name">{{ postUserName(post) }}</span>
      <span class="dot">•</span>
      <span class="date">{{ post.createdAt | extractDiffTime }}</span>
    </div>
<!-- Fullscreen overlay image (click anywhere to close) -->
<div class="img-fs" *ngIf="isImageEnlarged" (click)="toggleImageSize()">
  <img [src]="mediaUrl" alt="media" class="img-fs-img" />
</div>

    <div class="jdl-h-actions">
      <ion-button class="icon-btn" fill="clear" size="small" (click)="presentPopover($event)">
        <i class="fas fa-ellipsis-v"></i>
      </ion-button>

      <ng-container *ngIf="post.user.id === user.id">
        <div class="rel">
          <ion-button class="icon-btn" fill="clear" size="small" (click)="toggleVisibilityOptions($event)">
            <ion-icon name="eye"></ion-icon>
          </ion-button>
          <div class="custom-popover" [ngClass]="{'show': visibilityOptionsOpen}" #dropdown>
            <ion-list class="visibility-dropdown">
              <ion-item button (click)="changeVisibility('public')">
                <ion-icon name="earth" slot="start"></ion-icon><ion-label>Public</ion-label>
              </ion-item>
              <ion-item button (click)="changeVisibility('friends-only')">
                <ion-icon name="people" slot="start"></ion-icon><ion-label>Friends</ion-label>
              </ion-item>
              <ion-item button (click)="changeVisibility('private')">
                <ion-icon name="lock-closed" slot="start"></ion-icon><ion-label>Only me</ion-label>
              </ion-item>
            </ion-list>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- text -->
  <div class="jdl-text" [style]="{'color':'var(--post-fg)'}">{{ post.text }}</div>

  <!-- meta (events / dating) -->
  <div *ngIf="channel.type === 'static_events'" class="jdl-meta">
    <div><strong>Date</strong> {{ post.eventDate | date:'dd/MM/yyyy' }}</div>
    <div><strong>Location</strong> {{ post.eventLocation }}</div>
    <div><strong>Time</strong> {{ post.eventTime | date:'shortTime' }}</div>
  </div>

  <div *ngIf="channel.type === 'static_dating'" class="jdl-meta">
    <div><strong>Goals</strong> {{ post.relationshipGoals }}</div>
    <div><strong>Age</strong> {{ post.ageRange.min }}–{{ post.ageRange.max }}</div>
    <div><strong>Interests</strong> {{ post.interests.join(', ') }}</div>
    <div><strong>Hint</strong> {{ post.hintAboutMe }}</div>
  </div>

  <!-- media -->
  <div *ngIf="mediaUrl" class="jdl-media" (click)="toggleImageSize()">
    <img *ngIf="post.media?.url?.endsWith('.jpg') || post.media?.url?.endsWith('.webp') || post.media?.url?.endsWith('.png')"
         [src]="mediaUrl" alt="media"
         [class.enlarged]="isImageEnlarged"/>
    <video *ngIf="post.media?.url?.endsWith('.mp4') || post.media?.url?.endsWith('.webm')"
           [src]="mediaUrl" controls playsinline></video>

    <div *ngIf="post.media?.expiryDate && getTimeRemaining(post.media.expiryDate.toISOString()) !== ''"
         class="expiry-badge">
      {{ getTimeRemaining(post.media.expiryDate.toISOString()) }}
    </div>
  </div>

  <!-- actions: ↑ score ↓ • comments -->
  <div class="jdl-actions">
    <ion-button class="icon-btn" fill="clear" size="small" (click)="voteOnPost(1)">
      <i class="fas fa-chevron-up"></i>
    </ion-button>
    <span class="score">{{ post.votes }}</span>
    <ion-button class="icon-btn" fill="clear" size="small" (click)="voteOnPost(-1)">
      <i class="fas fa-chevron-down"></i>
    </ion-button>

    <div class="spacer"></div>

    <ion-button *ngIf="showCommentsBtn" class="icon-btn" fill="clear" size="small" (click)="showComments()">
      <i class="far fa-comments"></i>
      <span class="c-count">{{ post.comments?.length }} comments</span>
    </ion-button>
  </div>
</ion-card>
